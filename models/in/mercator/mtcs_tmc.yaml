########################################################################################################################
#                                                                                                                      #
# Models generated by the TwinCAT TMC editor.                                                                          #
#                                                                                                                      #
########################################################################################################################


##########################################################################
# Define the containing PLC library
##########################################################################

!LIBRARY mtcs_tmc:


  ########################################################################################################################
  # TmcTarget
  ########################################################################################################################
  
  !STRUCT TmcTarget:
      items:
          rc: { type: t_double , comment: "Object mean right ascention (alpha) in radians" }
          dc: { type: t_double , comment: "Object mean declination (delta) in radians" }
          pr: { type: t_int16  , comment: "Object Right Ascention proper motion in radians/year (do not multiply by cos(dc)!)" }
          pd: { type: t_int16  , comment: "Object declination proper motion in radians/year" }
          px: { type: t_double , comment: "Object parallax in arcseconds" }
          rv: { type: t_double , comment: "Object radial velocity in km/s" }
  
  
  
  ########################################################################################################################
  # TmcLocation
  ########################################################################################################################
  
  !STRUCT TmcLocation:
      items:
          xp      : { type: t_float   , comment: "Earth polar motion x in radians" }
          yp      : { type: t_float   , comment: "Earth polar motion y in radians" }
          dx      : { type: t_float   , comment: "Nutation adjustment dX in radians" }
          dy      : { type: t_float   , comment: "Nutation adjustment dY in radians" }
          elong   : { type: t_double  , comment: "East longitude in radians" }
          phi     : { type: t_double  , comment: "latitude in radians" }
          hm      : { type: t_float   , comment: "Height above sea level in meters" }
          tk      : { type: t_float   , comment: "Local temperature in Kelvin" }
          phpa    : { type: t_float   , comment: "Local pressure in hectoPascal = millibar" }
          rh      : { type: t_float   , comment: "Local relative humidity as a fraction (0...1)" }
          wlfq    : { type: t_float   , comment: "Observing wavelength in microns" }
          tlr     : { type: t_float   , comment: "Tropospheric lapse rate in K/m" }
  
  ########################################################################################################################
  # TmcAzEl
  ########################################################################################################################
  
  !STRUCT TmcAzEl:
      items:
          az      : { type: t_double  , comment: "Azimuth in radians" }
          el      : { type: t_double  , comment: "Elevation in radians" }
  
  ########################################################################################################################
  # TmcAzElFull
  ########################################################################################################################
  
  !STRUCT TmcAzElFull:
      items:
          az      : { type: t_double  , comment: "Azimuth in radians" }
          azd     : { type: t_double  , comment: "Azimuth velocity in radians per second" }
          azdd    : { type: t_double  , comment: "Azimuth acceleration in radians/s2" }
          el      : { type: t_double  , comment: "Elevation in radians" }
          eld     : { type: t_double  , comment: "Elevation velocity in radians per second" }
          eldd    : { type: t_double  , comment: "Elevation acceleration in radians/s2" }
          pa      : { type: t_double  , comment: "Parallactic Angle in radians" }
          pad     : { type: t_double  , comment: "Parallactic Angle velocity in radians per second" }
          padd    : { type: t_double  , comment: "Parallactic Angle acceleration in radians/s2" }
  
  ########################################################################################################################
  # TmcRaDec
  ########################################################################################################################
  
  !STRUCT TmcRaDec:
      items:
          ra      : { type: t_double  , comment: "Right ascention (alpha) in radians" }
          dec     : { type: t_double  , comment: "Declination (delta) in radians" }
  
  
  ########################################################################################################################
  # TmcObserved
  ########################################################################################################################
  
  !STRUCT TmcObserved:
      items:
          aob     : { type: t_double  , comment: "Observed azimuth (radians: North=0, East=PI/2)" }
          zob     : { type: t_double  , comment: "Observed zentih distance (radians)" }
          hob     : { type: t_double  , comment: "Observed hour angle (radians)" }
          dob     : { type: t_double  , comment: "Observed declination (radians)" }
          rob     : { type: t_double  , comment: "Observed right ascention (radians)" }
  
  ########################################################################################################################
  # TmcTrue
  ########################################################################################################################
  
  !STRUCT TmcTrue:
      items:
          elong   : { type: t_double  , comment: "True longitude of the site (radians, east +ve)" }
          phi     : { type: t_double  , comment: "True geodetic latitude of the site (radians)" }
          daz     : { type: t_double  , comment: "Azimuth correction for true longitude and latitude (terrestrial - celestial, radians)" }
  
  
  ########################################################################################################################
  # TmcProcessedTarget
  ########################################################################################################################
  
  !STRUCT TmcProcessedTarget:
      items:
          given       : { type: TmcTarget     , comment: "The originally given target" }
          apparent    : { type: TmcRaDec      , comment: "Apparent target position" }
          quick       : { type: TmcAzElFull   , comment: "Quick computation results of target (without atmospheric refraction)" }
          observed    : { type: TmcObserved   , comment: "Observed target position" }
          observedFull: { type: TmcAzElFull   , comment: "Observed target position/velocity/acceleration" }
          isValid     : { type: t_bool        , comment: "Is the target valid?"}
          isTooLow    : { type: t_bool        , comment: "Is the target too low?"}
  
  ########################################################################################################################
  # TmcProcessedFeedback
  ########################################################################################################################
  
  !STRUCT TmcProcessedFeedback:
      items:
          apparent    : { type: TmcRaDec      , comment: "Apparent feedback position" }
          mean        : { type: TmcRaDec      , comment: "Mean feedback position" }
          isValid     : { type: t_bool        , comment: "Is the feedback valid?"}
          isTooLow    : { type: t_bool        , comment: "Is the feedback too low?"}
  
  
  
  ########################################################################################################################
  # TmcDateTime
  ########################################################################################################################
  
  !STRUCT TmcDateTime:
      items:
          years           : { type: t_int32 , comment: "Years, e.g. 2016" }
          months          : { type: t_int32 , comment: "Months, [1..12]" }
          days            : { type: t_int32 , comment: "Days, [1..31]" }
          hours           : { type: t_int32 , comment: "Hours, [0..23]" }
          minutes         : { type: t_int32 , comment: "Minutes, [0..59]" }
          seconds         : { type: t_int32 , comment: "Secconds, [0..60] (60 during leap second event!)" }
          microseconds    : { type: t_int32 , comment: "Microseconds, [0..999999]" }
          fractionOfDay   : { type: t_double, comment: "Fraction of the day, [0.0..1.0[" }
  
  
  ########################################################################################################################
  # TmcUnixTime
  ########################################################################################################################
  
  !STRUCT TmcUnixTime:
      items:
          sec : { type: t_int64  , comment: "Seconds from Jan 1, 1970" }
          usec: { type: t_int64  , comment: "Microseconds" }
  
  ########################################################################################################################
  # TmcTimingMode
  ########################################################################################################################
  
  !ENUMERATION TmcTimingMode:
      items:
          [ "LOCAL_CLOCK",
            "PTP_IEEE_1588" ]
  
  
  ########################################################################################################################
  # TmcUtcTime
  ########################################################################################################################
  
  !STRUCT TmcUtcTime:
      items:
          dcTime              : { type: t_int64       , comment: "DC time" }
          mode                : { type: TmcTimingMode , comment: "Local clock or PTP?" }
          unixTime            : { type: TmcUnixTime   , comment: "UTC as Unix time" }
          mjd                 : { type: t_double      , comment: "UTC as Modified Julian Days" }
          dateTime            : { type: TmcDateTime   , comment: "EtherCAT master: Offset between DC and TwinCAT time (in ns)" }
  
  ########################################################################################################################
  # TmcUt1Time
  ########################################################################################################################
  
  !STRUCT TmcUt1Time:
      items:
          mjd                 : { type: t_double              , comment: "UT1 as Modified Julian Days" }
  
  
  ########################################################################################################################
  # TmcAxesErrors
  ########################################################################################################################
  
  !ENUMERATION TmcAxesErrors:
      items:
          [ "AXES_NO_ERROR",
            "AXES_OBJECT_RC_OUT_OF_RANGE",
            "AXES_OBJECT_DC_OUT_OF_RANGE",
            "AXES_OBJECT_PR_OUT_OF_RANGE",
            "AXES_OBJECT_PD_OUT_OF_RANGE",
            "AXES_OBJECT_PX_OUT_OF_RANGE",
            "AXES_EQ_OUT_OF_RANGE",
            "AXES_LOCATION_XP_OUT_OF_RANGE",
            "AXES_LOCATION_YP_OUT_OF_RANGE",
            "AXES_LOCATION_DX_OUT_OF_RANGE",
            "AXES_LOCATION_DY_OUT_OF_RANGE",
            "AXES_LOCATION_ELONG_OUT_OF_RANGE",
            "AXES_LOCATION_PHI_OUT_OF_RANGE",
            "AXES_LOCATION_HM_OUT_OF_RANGE",
            "AXES_LOCATION_TK_OUT_OF_RANGE",
            "AXES_LOCATION_PHPA_OUT_OF_RANGE",
            "AXES_LOCATION_RH_OUT_OF_RANGE",
            "AXES_LOCATION_WLFQ_OUT_OF_RANGE",
            "AXES_LOCATION_TLR_OUT_OF_RANGE",
            "AXES_FEEDBACK_AZ_OUT_OF_RANGE",
            "AXES_FEEDBACK_EL_OUT_OF_RANGE" ]
  
  ########################################################################################################################
  # TmcTimingErrors
  ########################################################################################################################
  
  !ENUMERATION TmcTimingErrors:
      items:
          [ "TIMING_NO_ERROR",
            "TIMING_DUT_OUT_OF_RANGE",
            "TIMING_GETCURDCTIME_FAILED" ]
  
  
  ########################################################################################################################
  # TmcFromIoEcatMaster
  ########################################################################################################################
  
  !STRUCT TmcFromIoEcatMaster:
      items:
          dcToTcTimeOffset    : { type: t_int64   , comment: "EtherCAT master: Offset between DC and TwinCAT time (in ns)" }
          dcToExtTimeOffset   : { type: t_int64   , comment: "EtherCAT master: Offset between Dc and external time (in ns)" }
  
  ########################################################################################################################
  # TmcFromIoEL6688
  ########################################################################################################################
  
  !STRUCT TmcFromIoEL6688:
      items:
          internalTimestamp   : { type: t_uint64  , comment: "EL6688 module: internal timestamp" }
          externalTimestamp   : { type: t_uint64  , comment: "EL6688 module: external timestamp" }
          notConnected        : { type: t_bool    , comment: "EL6688 module: not connected" }
          updateToggle        : { type: t_bool    , comment: "EL6688 module: update toggle" }
  
  ########################################################################################################################
  # TmcFromIo
  ########################################################################################################################
  
  !STRUCT TmcFromIo:
      items:
          fromEL6688          : { type: TmcFromIoEL6688       , comment: "Connect to inputs of EL6688" }
          fromEcatMaster      : { type: TmcFromIoEcatMaster   , comment: "Connect to inputs of EtherCAT master" }
  
  ########################################################################################################################
  # TmcFromPlcAxes
  ########################################################################################################################
  
  !STRUCT TmcFromPlcAxes:
      items:
          object      : { type: TmcTarget     , comment: "Target" }
          equinox     : { type: t_double      , comment: "Epoch of mean equinoxes (e.g. 2000.0)" }
          location    : { type: TmcLocation   , comment: "Location of the observatory" }
          feedback    : { type: TmcAzEl       , comment: "Feedback position (by the encoders)" }
  
  
  ########################################################################################################################
  # TmcFromPlcTiming
  ########################################################################################################################
  
  !STRUCT TmcFromPlcTiming:
      items:
          dut                 : { type: t_double              , comment: "Delta UT (=UT1 - UTC, floating point between 0 and 1 second)" }
          leapSeconds         : { type: t_int32               , comment: "Number of leap seconds" }
          alwaysUseLocalClock : { type: t_bool                , comment: "If TRUE, then the local clock (source=LOCAL_CLOCK) will be used even if an external (more accurate!) clock is available" }
  
  
  ########################################################################################################################
  # TmcFromPlc
  ########################################################################################################################
  
  !STRUCT TmcFromPlc:
      items:
          fromAxes            : { type: TmcFromPlcAxes    , comment: "Connect to outputs of PLC - MTCS - Axes" }
          fromTiming          : { type: TmcFromPlcTiming  , comment: "Connect to outputs of PLC - MTCS - Services/Timing" }
  
  ########################################################################################################################
  # TmcToPlcAxes
  ########################################################################################################################
  
  !STRUCT TmcToPlcAxes:
      items:
          polmo       : { type: TmcTrue               , comment: "True longitude/latitude/azimuth after polar motion correction" }
          last        : { type: t_double              , comment: "Local apparent sidereal time" }
          ha          : { type: t_double              , comment: "Hour angle in radians" }
          object      : { type: TmcProcessedTarget    , comment: "Processed target" }
          feedback    : { type: TmcProcessedFeedback  , comment: "Processed feedback" }
          error       : { type: TmcAxesErrors         , comment: "0 = no error" }
  
  
  ########################################################################################################################
  # TmcToPlcTiming
  ########################################################################################################################
  
  !STRUCT TmcToPlcTiming:
      items:
          utc         : { type: TmcUtcTime            , comment: "UTC time" }
          ut1         : { type: TmcUt1Time            , comment: "UT1 time" }
          error       : { type: TmcTimingErrors       , comment: "0 = no error" }
  
  ########################################################################################################################
  # TmcToPlc
  ########################################################################################################################
  
  !STRUCT TmcToPlc:
      items:
          toAxes      : { type: TmcToPlcAxes          , comment: "Connect to inputs of PLC - MTCS - Axes" }
          toTiming    : { type: TmcToPlcTiming        , comment: "Connect to inputs of PLC - MTCS - Services/Timing" }
  